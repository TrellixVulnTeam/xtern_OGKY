#!/bin/bash

cd $XTERN_ROOT/apps/pbzip2
rm -rf out* serializer.log
tar cvf input.tar $LLVM_ROOT/install/bin/llvm-ar &> /dev/null
APP=$XTERN_ROOT/apps/pbzip2/pbzip2
INPUT="-p2 -rkvf input.tar"

# Run with xtern and draw time chart.
LD_PRELOAD=$XTERN_ROOT/dync_hook/interpose.so $APP $INPUT
mv out out-rr
$XTERN_ROOT/eval/draw-time-chart.pl ./out-rr
mv time-chart.txt rr-time-chart.txt

# Run non-det and draw time chart.
LD_PRELOAD=$XTERN_ROOT/eval/dyn-intercept-calls/dyn-intercept-calls.so $APP $INPUT
mv out out-random
$XTERN_ROOT/eval/draw-time-chart.pl ./out-random
mv time-chart.txt random-time-chart.txt
